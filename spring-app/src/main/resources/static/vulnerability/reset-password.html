<html>
<body>
<h2>Reset your password</h2>
Your username: <input type="text" id="username" placeholder="Username"/>
<input type="button" value="Reset" onclick="resetPassword()"/>
<div id="step1-message"></div>


<div id="step2" style="display: none">
    Enter the 6-digit code you received on your phone: <input type="text" id="code"/> <br/>
    Enter your new password: <input type="password" id="password"/> <br/>
    <input type="button" value="Set new Password" onclick="resetPasswordStep2()"/>
    <div id="step2-message"></div>
</div>


<script type="text/javascript">
    resetPassword = () => {
        let username = document.getElementById('username').value;
        fetch(`/user/${username}/reset-password/step1`)
            .then((response) => response.text())
            .then((data) => {
                document.getElementById('step1-message').innerText = data;
                document.getElementById('step2').style.display = 'block';
            })
        ;
    };

    resetPasswordStep2 = () => {
        let username = document.getElementById('username').value;
        let code = document.getElementById('code').value;
        let password = document.getElementById('password').value;
        fetch(`/user/${username}/reset-password/step2`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                smsCode: code,
                newPassword: password
            })
        })
            .then((response) => response.text())
            .then((data) => {
                document.getElementById('step2-message').innerText = data;
            })
        ;
    };
</script>

</body>
</html>
