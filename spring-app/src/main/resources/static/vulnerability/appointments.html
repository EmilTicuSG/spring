<html>

<head>
    <link href="../toastr.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="../toastr.min.js"></script>
    <script type="text/javascript" src="../jquery-1.12.2.min.js"></script>
</head>

<body>
<h2>Request Appointment</h2>
<div id="patient-details">
    <h3>Step 1: Patient Details</h3>
    Name: <input id="name" type="text" value="patient-name"> <br>
    Phone: <input id="phone" type="text" value="0123456789"> <br>
    Email: <input id="email" type="text" value="patient@gmail.com"> <br>
    <button onclick="createPatient()">Create Profile</button>
</div>
<script type="text/javascript">
    let patientId;

    const dummyNames = ["Adams","Baker","Clark","Davis","Evans","Frank","Ghosh","Hills","Irwin","Jones","Klein","Lopez","Mason","Nalty","Ochoa","Patel","Quinn","Reily","Smith","Trott","Usman","Valdo","White","Xiang","Yakub","Zafar"];
    function pickRandomPatient(i) {
        document.getElementById("name").value = dummyNames[i];
        document.getElementById("phone").value = "+407"+Math.floor(1000000 + Math.random() * 9000000);
        document.getElementById("email").value = dummyNames[i].toLowerCase()+"@gmail.com";

    }
    pickRandomPatient(Math.floor(Math.random() * dummyNames.length))

    function createPatient() {
        fetch('/api/vulnerability/appointments/patient', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: document.getElementById("name").value,
                phone: document.getElementById("phone").value,
                email: document.getElementById("email").value,
            })
        })
            .then((response) => response.json())
            .then((data) => {
                patientId = data;
                document.getElementById('appointment-request').style.display = 'inline';
                $("#patient-details *").prop('disabled',true);

            })
    }

</script>


<div id="appointment-request" style="display: none">
    <h3>Step 2: Appointment Details</h3>
    Specialty:
        <select id="specialty" >
            <option value="OPHTHALMOLOGY">Ophthalmology</option>
            <option value="CARDIOLOGY">Cardiology</option>
            <option value="RADIOLOGY">Radiology</option>
        </select>
    <br>
    Date: <input id="date" type="text" value="2023-11-02"> <br>
    Time: <input id="time" type="text" value="17:00"> <br>
    Notes: <input id="notes" type="text" value="I hope it's nothing"> <br>
    <button onclick="createAppointment()">Create Appointment Request</button>
</div>

<script type="text/javascript">

    function createAppointment() {
        fetch('/api/vulnerability/appointments/request', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                // patientId: patientId, // if I pass an arbitrary ID, I get the data of another patient in response
                specialty: document.getElementById("specialty").value,
                date: document.getElementById("date").value,
                time: document.getElementById("time").value,
                notes: document.getElementById("notes").value
            })
        })
            .then((response) => response.json())
            .then((data) => {
                document.getElementById('nameFinal').textContent = data.patientName;
                document.getElementById('phoneFinal').textContent = data.patientPhone;
                document.getElementById('emailFinal').textContent = data.patientEmail;
                document.getElementById('specialtyFinal').textContent = data.specialty;
                document.getElementById('whenFinal').textContent = data.when;

                document.getElementById('confirmation').style.display = 'inline';
                $("#appointment-request *").prop('disabled',true);
            })
    }

</script>

<div  id="confirmation" style="display: none">
    <h3>Step 3: Confirmation</h3>
    Name: <span id="nameFinal"></span> <br>
    Phone: <span id="phoneFinal"></span> <br>
    Email: <span id="emailFinal"></span> <br>
    When: <span id="whenFinal"></span> <br>
    Specialty: <span id="specialtyFinal"></span> <br>
    <button>Looks good!</button>
</div>

</body>
</html>
