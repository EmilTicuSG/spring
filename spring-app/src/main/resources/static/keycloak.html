<html>

<head>
    <link href="toastr.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="jquery-1.12.2.min.js"></script>
    <script type="text/javascript" src="toastr.min.js"></script>

</head>

<body>

<h2>Implicit Flow with KeyCloak</h2>
<div id="oauthstatus">Loading...</div>

<script type="text/javascript" src="http://localhost:8180/auth/js/keycloak.js"></script>
<script>
    var keycloak;
    function initKeycloak() {
        keycloak = new Keycloak();
        keycloak.init({
            onLoad: "login-required"
        }).then(function(authenticated) {
            oauthstatus.innerText = authenticated ? 'authenticated' : 'NOT authenticated';
        }).catch(function(e) {
            oauthstatus.innerText = 'failed to initialize';
            console.log(e);
        });
    }
    initKeycloak();

    function transferAmount() {

        $.ajax("http://localhost:8080/api/victim/transfer-rest", {
            method: "POST",
            // xhrFields: { withCredentials: true }, // CORS sending credentials
            data: JSON.stringify({
                recipientFullName: $("#fullName").val(),
                recipientIban: $("#iban").val(),
                amount: $("#amount").val()
            }),
            contentType: "application/json",
            headers: {
                "Authorization": "Bearer "+ keycloak.token
            },
            success: function (trainings) {
                toastr.success("Money Transferred")
            }
        });
    }
</script>

<input type="button" value="Transfer (with Authorization Token)" onclick="transferAmount()">

</body>
</html>
